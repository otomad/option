# **拼音格式化** <span style="font-weight:normal">使用说明</span>

- 本项目设计的初衷是实在不想通过输入法自带的符号列表中慢慢找拼音字母了，因为那样实在是太痛苦了。
- 可以通过输入不带声调的拉丁字母与数字（或汉字）来转换为带有声调的拼音形式，也可以将整段文字粘贴进文本框批量转换，方便使用。

### 本项目的开源版本

下述日期均为对应项目工程开始日期。

- C 语言 版本
  - 2020/9/4
  - 输出单字，因为不支持合字。
- Lua 版本
  - 2020/9/12
  - 输出合字，谨慎使用。
- JavaScript 版本
  - 2020/9/24
  - 内部输出合字，但是最后会转换为单字。
- PHP 版本
  - 2021/2/24
  - 输出合字，谨慎使用。

**注：**

- **单字**：Unicode 拥有独立字形码位的字符，一般一律使用单字。因此 JavaScript 版本为方便复制使用而在输出之后转换回单字。
- **合字**：Unicode 利用 **“组合用”** 字符合并出来的字符，若通过这种方法合并出来的字符是 Unicode 表中已有的字符，或者由字体定义了合字字形，在确保设备系统及时跟进的情况下，显示出来是与单字无差异的。若该字符不在表中，则通过系统渲染一个字形作为该字符，往往字形并不是很好看。若设备不支持 Unicode，可能无法正常显示合字。因此上述语言版本输出若是合字的（Lua、PHP 等），输出的字符在不支持 Unicode 的设备或复制到不支持 Unicode 的设备中显示，会显示异常。因此谨慎使用。

---

## C 语言 版本

- 在 Visual Studio 2019 环境下编写，不保证其它平台 _（尤其指 Visual C++ 6.0）_ 能够正常编译。
- C 语言版本是本项目创建的第一个语言版本，因为在当时我只会 C 语言。
- 最大只支持 100 个字符输入，拼音与拼音之间用隔音符号 **“'”** 分隔。
- 由于 C 语言对 Unicode 字符集兼容性欠佳 _（当然更有可能是我技术力过低）_ ，只能通过 ANSI 编码（在简体中文环境下显示的是 GBK 编码）进行处理。由于 GBK 编码支持**部分**带有附标的拉丁字母，因此这些字符得以正常显示出来，其它字符均呈问号。正因如此，这个版本需要逐个替换字符，而其它语言版本均可方便地支持 Unicode 而通过 “组合用附加符号” 来实现操作。

---

## Lua 版本

本 Lua 版本是运行在 MediaWiki 的模块及其模板上使用的，因此使用源码只能在 MediaWiki 系统上运行，标准的 Lua 需要做一些转换方能运行。

以下是在 wiki 页面的模板文档：

## Template:Pyfmt

> **本模板使用 Lua 语言编写，如果您不太熟悉本语言，请慎重使用本模板。**  
> 否则建议请根据下面的步骤，一步一步操作。

> 本模板使用[Lua 语言](https://en.wikipedia.org/wiki/Lua)：  
> [Module:Pyfmt]()

**拼音格式化（Pinyin Formatting）**。本模板使用 Lua 语言。以方便用户快速输入带声调的汉语拼音。

例如，本模板可以使编辑者只需输入在键盘上十分容易键入的 chuang4，即可得到 chuàng。

### 用法

`{{pyfmt|ASCII汉语拼音|类型}}`

其中，**“ASCII 汉语拼音”** 为必选参数，**“类型”** 为可选参数。

本模板全都是编号参数。

- **ASCII 汉语拼音**
  - 此处填写只需使用 ASCII 字符就能轻易输入的（即标准键盘有的字符）能够被人类轻易理解，且也不必考虑计算机编码不支持的问题，但不是很美观的汉语拼音。前面是不带声调的基本拉丁字母，最后一个字符表示声调，用数字表示。具体规则请参考下面的[规则]()。本参数必须填写，否则可能会产生错误。
- **类型**
  - 本参数可选填写，缺省表示为 0。以 chuang4 为例，具体填写参数请参考下表。

| 参数[^1]                                                   | 类型                                 | 效果   |
| ---------------------------------------------------------- | ------------------------------------ | ------ |
| 0 <br><small>缺省填写或任意填写其它内容</small>            | 全部小写字母                         | chuàng |
| 1 <br><small>大写<br>大<br>upr<br>upper<br>capital</small> | 全部大写字母                         | CHUÀNG |
| 2 <br><small>小型大写字母<br>small capital</small>         | 全部小型大写字母                     | ᴄʜᴜᴀ̀ɴɢ |
| 3 <br><small>首字母大写</small>                            | 首字母大写，其它全部小写字母         | Chuàng |
| 4                                                          | 首字母大写，其它全部小型大写字母[^2] | Cʜᴜᴀ̀ɴɢ |

### 注意

- 拼音可以输入大写，也可以输入小写，也可以混合输入。但是内部会全部转换成小写处理。最后根据“类型”参数，全部转换成大写或保留小写。
- 请不要尝试输入错误的拼音，否则可能会产生意外的结果。
- 本模板一次只允许输入一个拼音，如希望转换一句话的拼音，请[参见]()下面的其它模板。
- 所有的声调采用 Unicode 的组合用附加符号实现，绝大多数系统均可正常显示字符，极少数系统由于缺少字体，显示出来的字符非常诡异。
- 若希望输出大写拼音，少数罕见拼音带声调的字母如“ê”“ü”等的大写“Ê”“Ü”会因为字符过于高大，导致声调没能显示在本行或者被本行直接截断。
- 小型大写字母由于十分罕见，Unicode 官方几乎不给它们基于带附标的字符，因此声调会错位。本问题无解，但也可以用于使用不带调的小型大写字母拼音。
- 小型大写字母 Q，绝大多数设备无法正常显示；Unicode 并没有小型大写字母 X，因此用小写字母代替。
- 本模板允许在一定的范围内输入不合法的拼音，比如：duang1、gi1、giao4 等。但也是有局限的。
- 当不合法拼音包含多个相同的应该带声调的字母时，只给第一个该字母注音。如：daa4 会被注音为 dàa。

### 规则

- 先输入不带声调的拼音的英文字母，大小写均可，最后输入的一个数字表示声调。  
  <span style="color:red">（请不要尝试在除拼音结尾处之外的其它任意位置输入数字。）</span>
- 用 **v** 表示 **ü**。此外，新规护照所采用的用 **yu** 表示 **ü** 亦可使用，只不过仅用于《新华字典》中已有的读音，人为造的发音在这里并不适用，但依然可以用 **v** 表示。
- **j、q、x、y** 后接的 ü 应手动打成 **u**，不能依靠本模板自动转换。人为输入的 jv 会被转换成 jü 这种错误形式。
- 若希望输入拼音字母 **ê**，可以使用 **eh** 或者 **e^**。
- 这里，汉语拼音对字母（不一定是韵母）的注音顺序依次是：**a**、**o**、**e**、ê、**i**、**u**、**ü**、n、m。其中**加粗**的为汉语拼音方案中标准的注音顺序，不加粗的是本模板所采用的顺序。**唯有一个例外的是**，拼音 **iu** 会被注音在 **u** 上，而不是上述规则中的 i。
- 拼音若不包含上述可标声调的字母，不注音。
- 关于末尾的数字所表示的声调，请参考下表。

| 末尾数字 | 1    | 2    | 3    | 4    | 5    | 0    |
| -------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 含义     | 阴平 | 阳平 | 上声 | 去声 | 入声 | 轻声 |
| 符号     | ˉ    | ˊ    | ˇ    | ˋ    | ˙    | [^3] |

### 示例

| 代码                     | 效果   |
| ------------------------ | ------ |
| `{{pyfmt\|chuang4}}`     | chuàng |
| `{{pyfmt\|zhi3}}`        | zhǐ    |
| `{{pyfmt\|jiu1}}`        | jiū    |
| `{{pyfmt\|wi1}}` [^4]    | wī     |
| `{{pyfmt\|xu5}}`         | xu̇     |
| `{{pyfmt\|lve4}}`        | lüè    |
| `{{pyfmt\|lyu3}}`        | lǚ     |
| `{{pyfmt\|seh1}}`        | sê̄     |
| `{{pyfmt\|se^2}}`        | sế     |
| `{{pyfmt\|hng1}}`        | hn̄g    |
| `{{pyfmt\|nu4\|1}}`      | NÙ     |
| `{{pyfmt\|qi1\|大写}}`   | QĪ     |
| `{{pyfmt\|AO4\|0}}` [^5] | ào     |
| `{{pyfmt\|vv1}}` [^6]    | vǖ     |
| `{{pyfmt\|de\|2}}` [^7]  | ᴅᴇ     |

[^1]: 小字部分为兼容填写参数，其中英文不必区分大小写。
[^2]: 主要用于填写姓氏拼音。
[^3]: （无符号）
[^4]: 测试不合法拼音。
[^5]: 大写拼音恢复。<br>尽管输入的为大写，但是始终以“类型”标签所表示的为准。
[^6]: 首字母的v依然保持为v，作为声母，主要用于表示方言。而之后的所有v才会被转义为ü。<br>不过似乎vü这个音并不容易读出来。
[^7]: 拼音的末尾不输入表示声调的数字，效果等同于轻声。

## Template:Pystc

> **本模板使用 Lua 语言编写，如果您不太熟悉本语言，请慎重使用本模板。**  
> 否则建议请根据下面的步骤，一步一步操作。

> 本模板使用[Lua 语言](https://en.wikipedia.org/wiki/Lua)：  
> [Module:Pyfmt]()

**拼音格式化句子（Pinyin Formatting Sentence）**。本模板使用 Lua 语言。基于[模板:Pyfmt]()，共同使用[模块:Pyfmt]()。

主要用于连续调用 {{pyfmt}} 模板，一次性快速输入一整句话的拼音。

### 问题

- 本模板具有局限性，并没有 {{pyfmt}} 的高自由度。因此本模板只是使用更方便，但是功能并不强大。
- 本模板预期希望能更方便的输出人名拼音，然而似乎并不容易做到。内地姓名拉丁化规范如：武则天 (Wǔ Zétiān)、欧阳修 (Ōuyáng Xiū) 等。由于不管是分隔还是大写，都不容易用算法自动生成。因此并不能用本模板便捷地输入人名拼音。
- 本模板是一个字一个字分隔拼音，不能根据词组或意群自动分隔。
- 如果将“分隔符”参数留空 **（留空不是缺省）**，则会自动根据需要在 a、o、e 前添加隔音符号。此时的隔音符号默认使用“'”，即直单引号，暂时不可更改为其它。

### 用法

`{{pystc|句子的拼音 `<span style="color:red">\*</span>`|分隔符|类型}}`

其中，星号为必选参数，其余均可选。

本模板全都是编号参数。

- **句子的拼音**
  - 可以一次性填写一句话的拼音，拼音输入的规则参考[模板:Pyfmt#规则]()。此外，拼音与拼音之间要求使用直单引号 “**'**” 隔开。正确的填写方式如：`wei2'ji1'bai3'ke1` _（维基百科）_
- 分隔符
  - 拼音与拼音之间的分隔符。默认为“ ”，即空格。
  - 当手动将“分隔符”参数设为没有任何内容之后，拼音与拼音将会连接显示在一起。不过当且仅当此时，会自动根据需要自动添加隔音符号，符号固定为“'”，即直单引号。其它情况（包括默认）都不会添加隔音符号。
  - 常用的分隔符示例如下表（不局限于下表，可以任意使用自己喜欢的符号作为分隔符）。

| 分隔符   | 代码                            | 效果        | 备注                                                                                                                     |
| -------- | ------------------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------ |
| （空格） | `{{pystc\|tian1'an1'men2\| }}`  | tiān ān mén | 缺省即为该项，因此亦可不填。                                                                                             |
| （留空） | `{{pystc\|tian1'an1'men2\|}}`   | tiān'ānmén  | 拼音会堆积在一起，此时会出现隔音符号。                                                                                   |
| '        | `{{pystc\|tian1'an1'men2\|'}}`  | tiān'ān'mén | 直单引号。英文键盘下直接输入的字符。                                                                                     |
| ’        | `{{pystc\|tian1'an1'men2\|’}}`  | tiān’ān’mén | 弯单引号。该字符显示效果一般比直单引号更好。不过有些设备会因为使用中文字体的缘故，致使该符号显示为全角，反而更影响美观。 |
| -        | `{{pystc\|tian1'an1'men2\| -}}` | tiān-ān-mén | 常用于港澳地区的姓名拼音，拼音与拼音直接用连字符连接起来。也多用于复姓的表示。                                           |

- 类型
  - 此处填写最终显示的拼音的类型，缺省为 **0**，即小写字母，一般只需填写数字即可。{{[pyfmt]()}} 模板中所支持的如“大写”“小型大写字母”等兼容参数此处依然有效，不过不再赘述，具体可参见[模板:Pyfmt#类型]()。此处在 {{[pyfmt]()}} 中所支持的 5 种类型之外，又额外增加了两种类型以方便使用。具体可填参数参考下表。

| 参数 | 类型                                     | 代码                                 | 效果          |
| ---- | ---------------------------------------- | ------------------------------------ | ------------- |
| 0    | 全部小写字母                             | `{{pystc\|feng1'he2'ri4'li4\| \|0}}` | fēng hé rì lì |
| 1    | 全部大写字母                             | `{{pystc\|feng1'he2'ri4'li4\| \|1}}` | FĒNG HÉ RÌ LÌ |
| 2    | 全部小型大写字母                         | `{{pystc\|feng1'he2'ri4'li4\| \|2}}` | ꜰᴇ̄ɴɢ ʜᴇ́ ʀɪ̀ ʟɪ̀ |
| 3    | 所有拼音首字母大写，其余小写字母         | `{{pystc\|feng1'he2'ri4'li4\| \|3}}` | Fēng Hé Rì Lì |
| 4    | 所有拼音首字母大写，其余小型大写字母     | `{{pystc\|feng1'he2'ri4'li4\| \|4}}` | Fᴇ̄ɴɢ Hᴇ́ Rɪ̀ Lɪ̀ |
| 5    | 仅第一个拼音首字母大写，其余小写字母     | `{{pystc\|feng1'he2'ri4'li4\| \|5}}` | Fēng hé rì lì |
| 6    | 仅第一个拼音首字母大写，其余小型大写字母 | `{{pystc\|feng1'he2'ri4'li4\| \|6}}` | Fᴇ̄ɴɢ hé rì lì |

## Template:Rubypy

<ruby>{{{1}}} <rp>(</rp><rt>{{{2}}}</rt><rp>)</rp></ruby>

本模板结合使用 {{[ruby]()}} 和 {{[pyfmt]()}} 两个模板，旨在更易于使用。

### 用法

`{{rubypy|内容|拼音}}`

两个参数均必填。

其中，拼音可以直接使用纯英文字母加数字表示声调。

### 示例

`{{rubypy|创|chuang4}}`

效果：

<ruby style="font-size:200%">创 <rp>(</rp><rt>chuàng</rt><rp>)</rp></ruby>

---

## JavaScript 版本

- JavaScript 版本通过前端网页实现，因此你可以在 GitHub 的页面中在线使用本功能。

### 目前支持的模式

1. 汉语拼音 `fàn lì wén běn`
2. 注音符号 `ㄈㄢˋ ㄌㄧˋ ㄨㄣˊ ㄅㄣˇ`
3. 国语罗马字 `fann lih wen been`
4. 官话合声字母

**注意：** 官话合声字母目前尚未被 Unicode 提供支持，目前通过私用区字体实现，只能在页面当中显示。如需复制到其它地方显示，需要安装对应字体。

### 支持的类型

1. 全部小写字母 `fàn lì wén běn`
2. 全部大写字母 `FÀN LÌ WÉN BĚN`
3. 全部小型大写字母 `ꜰᴀ̀ɴ ʟɪ̀ ᴡᴇ́ɴ ʙᴇ̌ɴ`
4. 所有拼音仅首字母大写，其余小写字母 `Fàn Lì Wén Běn`
5. 所有拼音仅首字母大写，其余小型大写字母 `Fᴀ̀ɴ Lɪ̀ Wᴇ́ɴ Bᴇ̌ɴ`
6. 仅第一个拼音仅首字母大写，其余小写字母 `Fàn lì wén běn`
7. 仅第一个拼音仅首字母大写，其余小型大写字母 `Fᴀ̀ɴ ʟɪ̀ ᴡᴇ́ɴ ʙᴇ̌ɴ`

**注：** **注音符号**和**官话合声字母**没有这些类型的支持。

### 允许直接输入的内容

1. 未格式化的拼音 `fan4'li4'wen2'ben3`
2. 格式化好的拼音 `fàn lì wén běn`
   - 主要用于将已经转换好了的拼音再转为其它模式或类型。
3. 汉字 `范例文本`

**注意：**

1. 不支持的字符（比如标点符号）会自动保留原文；
2. 拼音与拼音之间必须使用分隔符 **“'”** （直单引号）分隔。使用其它分隔符可能不会报错，但不推荐。可以尝试不输入分隔符，但是轻声必须要标注声调符号 **“0”** ，若省略不输入，会被识别成和后一个拼音组合在一起；
3. 可以试图混合输入。
4. 输入汉字，若遇到多音字，则一律只取其中一个默认读音。如这不是你预期的读音，请混合输入，手动将其改为 “未格式化的拼音” 的形式。目前不支持多音字自动识别也不打算支持，因为一是词库大影响使用性能，二是词库永远也不可能覆盖完全所有词语。

### 老傈僳文

- 在**同时**开启 **“国语罗马字”** 与 **“大写字母”** 的情况下，可以开启 **“老傈僳文”** 功能。仅将所有大写字母 _（除 Q 外）_ 更换为老傈僳文的字母，并无过多作用。

### 使用的开源代码

- [Bootstrap](https://getbootstrap.com)
- [GitHub - sxei/pinyinjs：一个实现汉字与拼音互转的小巧 web 工具库](https://github.com/sxei/pinyinjs/)
- [BinglunGe：官话合声字母字体及输入方案 - 知乎](https://zhuanlan.zhihu.com/p/110691578)

---

## PHP 版本

- 需要在服务器下方可运行，直接从本地文件打开或在 GitHub 中访问是无法打开的。
- 本功能并没有 JavaScript 前端版的全面。只有基本功能，且也没有转换合字、直接输入汉字等功能。

### index.php

- 通过表单 **GET** 方式提交实现。

### ajax.php

- 在其它页面通过 AJAX 来异步通过 **GET** 方式来获取结果。
- 该页面没有 UI，只能通过 URL 的参数获得结果。
